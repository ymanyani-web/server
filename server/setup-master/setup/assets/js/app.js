!function(e){e.waterfall=function(){var t=[],n=e.Deferred(),r=0;return e.each(arguments,function(a,s){t.push(function(){var a,l=[].slice.apply(arguments);"function"==typeof s?(a=s.apply(null,l))&&a.promise||(a=e.Deferred()[!1===a?"reject":"resolve"](a)):a=s&&s.promise?s:e.Deferred()[!1===s?"reject":"resolve"](s),a.fail(function(){n.reject.apply(n,[].slice.apply(arguments))}).done(function(e){r++,l.push(e),r==t.length?n.resolve.apply(n,l):t[r].apply(null,l)})})}),t.length?t[0]():n.resolve(),n}}(jQuery),function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,function(e){function t(e){return"function"==typeof e}function n(e){return m(e)?"array":typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(e,t){return null!=e&&"object"==typeof e&&t in e}function s(e,t){return g.call(e,t)}function l(e){return!s(I,e)}function i(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return v[e]})}function o(t,n){function a(e){if("string"==typeof e&&(e=e.split(b,2)),!m(e)||2!==e.length)throw new Error("Invalid tags: "+e);s=new RegExp(r(e[0])+"\\s*"),i=new RegExp("\\s*"+r(e[1])),o=new RegExp("\\s*"+r("}"+e[1]))}if(!t)return[];var s,i,o,d=[],f=[],h=[],g=!1,I=!1;a(n||e.tags);for(var v,S,k,x,M,T,q=new p(t);!q.eos();){if(v=q.pos,k=q.scanUntil(s))for(var R=0,_=k.length;R<_;++R)x=k.charAt(R),l(x)?h.push(f.length):I=!0,f.push(["text",x,v,v+1]),v+=1,"\n"===x&&function(){if(g&&!I)for(;h.length;)delete f[h.pop()];else h=[];g=!1,I=!1}();if(!q.scan(s))break;if(g=!0,S=q.scan(C)||"name",q.scan($),"="===S?(k=q.scanUntil(y),q.scan(y),q.scanUntil(i)):"{"===S?(k=q.scanUntil(o),q.scan(w),q.scanUntil(i),S="&"):k=q.scanUntil(i),!q.scan(i))throw new Error("Unclosed tag at "+q.pos);if(M=[S,k,v,q.pos],f.push(M),"#"===S||"^"===S)d.push(M);else if("/"===S){if(!(T=d.pop()))throw new Error('Unopened section "'+k+'" at '+v);if(T[1]!==k)throw new Error('Unclosed section "'+T[1]+'" at '+v)}else"name"===S||"{"===S||"&"===S?I=!0:"="===S&&a(k)}if(T=d.pop())throw new Error('Unclosed section "'+T[1]+'" at '+q.pos);return u(c(f))}function c(e){for(var t,n,r=[],a=0,s=e.length;a<s;++a)(t=e[a])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}function u(e){for(var t,n,r=[],a=r,s=[],l=0,i=e.length;l<i;++l)switch(t=e[l],t[0]){case"#":case"^":a.push(t),s.push(t),a=t[4]=[];break;case"/":n=s.pop(),n[5]=t[2],a=s.length>0?s[s.length-1][4]:r;break;default:a.push(t)}return r}function p(e){this.string=e,this.tail=e,this.pos=0}function d(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function f(){this.cache={}}var h=Object.prototype.toString,m=Array.isArray||function(e){return"[object Array]"===h.call(e)},g=RegExp.prototype.test,I=/\S/,v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},$=/\s*/,b=/\s+/,y=/\s*=/,w=/\s*\}/,C=/#|\^|\/|>|\{|&|=|!/;p.prototype.eos=function(){return""===this.tail},p.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},p.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},d.prototype.push=function(e){return new d(e,this)},d.prototype.lookup=function(e){var n,r=this.cache;if(r.hasOwnProperty(e))n=r[e];else{for(var s,l,i=this,o=!1;i;){if(e.indexOf(".")>0)for(n=i.view,s=e.split("."),l=0;null!=n&&l<s.length;)l===s.length-1&&(o=a(n,s[l])),n=n[s[l++]];else n=i.view[e],o=a(i.view,e);if(o)break;i=i.parent}r[e]=n}return t(n)&&(n=n.call(this.view)),n},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=o(e,t)),r},f.prototype.render=function(e,t,n){var r=this.parse(e),a=t instanceof d?t:new d(t);return this.renderTokens(r,a,n,e)},f.prototype.renderTokens=function(e,t,n,r){for(var a,s,l,i="",o=0,c=e.length;o<c;++o)l=void 0,a=e[o],s=a[0],"#"===s?l=this.renderSection(a,t,n,r):"^"===s?l=this.renderInverted(a,t,n,r):">"===s?l=this.renderPartial(a,t,n,r):"&"===s?l=this.unescapedValue(a,t):"name"===s?l=this.escapedValue(a,t):"text"===s&&(l=this.rawValue(a)),void 0!==l&&(i+=l);return i},f.prototype.renderSection=function(e,n,r,a){function s(e){return l.render(e,n,r)}var l=this,i="",o=n.lookup(e[1]);if(o){if(m(o))for(var c=0,u=o.length;c<u;++c)i+=this.renderTokens(e[4],n.push(o[c]),r,a);else if("object"==typeof o||"string"==typeof o||"number"==typeof o)i+=this.renderTokens(e[4],n.push(o),r,a);else if(t(o)){if("string"!=typeof a)throw new Error("Cannot use higher-order sections without the original template");o=o.call(n.view,a.slice(e[3],e[5]),s),null!=o&&(i+=o)}else i+=this.renderTokens(e[4],n,r,a);return i}},f.prototype.renderInverted=function(e,t,n,r){var a=t.lookup(e[1]);if(!a||m(a)&&0===a.length)return this.renderTokens(e[4],t,n,r)},f.prototype.renderPartial=function(e,n,r){if(r){var a=t(r)?r(e[1]):r[e[1]];return null!=a?this.renderTokens(this.parse(a),n,r,a):void 0}},f.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},f.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},f.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var S=new f;return e.clearCache=function(){return S.clearCache()},e.parse=function(e,t){return S.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return S.render(e,t,r)},e.to_html=function(n,r,a,s){var l=e.render(n,r,a);if(!t(s))return l;s(l)},e.escape=i,e.Scanner=p,e.Context=d,e.Writer=f,e});var Installer={currentStep:null,options:{page:"#page",form:"#setup-form",currentStepSelector:"#current-step",submitButton:'button[type="submit"]',progressBox:"#progress-box",flashMessageSelector:"#flash-message"},Steps:{requirements:{handler:"onCheckRequirements"},database:{handler:"onCheckDatabase"},settings:{handler:"onValidateSettings"},install:{dataCache:{},handler:"onInstall",steps:{download:{msg:"Downloading {{name}} {{type}}...",error:"Downloading {{name}} {{type}} failed. See setup log."},extract:{msg:"Extracting {{name}} {{type}}...",error:"Extracting {{name}} {{type}} failed. See setup log."},config:{msg:"Writing site configuration files...",error:"Writing site configuration files failed. See setup log."},install:{msg:"Finishing site setup...",error:"Finishing site setup failed. See setup log."}}},proceed:{proceedUrl:"/admin/settings",frontUrl:"/"},success:{}},init:function(){Installer.$page=$(Installer.options.page),Installer.$pageContent=Installer.$page.find('[data-html="content"]'),Installer.$pageModal=Installer.$page.find('[data-html="modal"]'),Installer.$progressBox=$(Installer.options.progressBox),Installer.currentStep=$(Installer.options.currentStepSelector).val(),Installer.renderView(Installer.currentStep),Installer.updateWizard(Installer.currentStep),$(document).ready(function(){Installer.$form=$(Installer.options.form),Installer.$submitBtn=$(Installer.options.submitButton),Installer.$form.submit(Installer.submitForm),Installer.$page.on("click","[data-install-control]",Installer.onControlClick),Installer.$pageModal.on("hidden.bs.modal",Installer.onModalHidden),"requirements"===Installer.currentStep&&Installer.checkRequirements()})},submitForm:function(e){e.preventDefault(),Installer.$submitBtn.hasClass("disabled")||(Installer.currentStep=$(Installer.options.currentStepSelector).val(),Installer.processForm())},onControlClick:function(e){var t=$(e.currentTarget);switch(t.data("installControl")){case"retry-check":Installer.checkRetry();break;case"load-license":var n=$('[data-partial="_popup_license"]').clone().html();Installer.$pageModal.html(Mustache.render(n)),Installer.$pageModal.modal();break;case"accept-license":Installer.sendRequest("onCheckLicense",{}).done(function(e){Installer.processResponse(e)});break;case"fetch-theme":Installer.fetchThemes();break;case"install-core":case"install-theme":Installer.processInstall(t)}},onModalHidden:function(e){$(e.currentTarget).find(".modal-dialog").remove()},disableSubmitButton:function(e){Installer.$submitBtn.prop("disabled",e),e?Installer.$submitBtn.addClass("disabled"):Installer.$submitBtn.removeClass("disabled")},getHandler:function(e){return Installer.Steps[e].handler},processForm:function(){if(Installer.$form.length){var e=Installer.getAlert(Installer.currentStep),t=Installer.getHandler(Installer.currentStep);Installer.sendRequest(t,{},e).done(function(e){Installer.processResponse(e)})}},sendRequest:function(e,t,n){t.handler=e;var r=void 0!==Installer.$form?Installer.$form.serialize()+(void 0===t?"":"&"+$.param(t)):[];return Installer.disableSubmitButton(!0),$.ajax({async:!0,type:"POST",cache:!0,data:r}).done(function(){Installer.disableSubmitButton(!1)}).fail(function(e){Installer.disableSubmitButton(!1),Installer.flashMessage("danger",e.responseText)})},getAlert:function(e){if(Installer.Steps.hasOwnProperty(e))return Installer.Steps[e].msg},checkRetry:function(){Installer.checkRequirements()},updateWizard:function(e){var t=["requirements","database","settings","install","proceed"];$(Installer.options.currentStepSelector).val(e);for(var n in t){var r=Installer.$page.find('[data-wizard="'+t[n]+'"]');if(r.removeClass("in-progress").addClass("complete"),t[n]===e){r.addClass("in-progress");break}}},checkRequirements:function(){var e=Installer.$page.find("[data-requirement]"),t=$("#requirement-check-result").empty(),n=$('[data-partial="_alert_check_failed"]').clone().html(),r=$('[data-partial="_alert_check_complete"]').clone().html(),a=Installer.Steps.requirements.handler,s=[],l=[],i=[],o=!0;e.addClass("d-none"),$.each(e,function(e,t){var n=$(t),r=n.data();s.push(function(){var e=$.Deferred(),t=n.find('[role="status"]');return n.removeClass("d-none"),Installer.sendRequest(a,{code:r.requirement}).done(function(a){setTimeout(function(){a.result?(n.addClass("done"),t.addClass("fas fa-circle text-success").removeClass("spinner-border"),e.resolve()):(o=!1,n.addClass("failed"),t.addClass("fas fa-circle text-danger").removeClass("spinner-border"),t.attr("title",r.hint),l.push(r.requirement),i.push(r.hint),e.resolve()),e.resolve()},1500)}).fail(function(){setTimeout(function(){o=!1,l.push(r.requirement),i.push(r.hint),n.addClass("failed"),t.attr("title",r.hint),e.resolve()},1500)}),e})}),$.waterfall.apply(this,s).always(function(){}).done(function(e){o?(Installer.$form.append('<input type="hidden" name="requirement" value="complete">'),t.append(Mustache.render(r)),t.show().addClass("animated fadeIn")):(t.append(Mustache.render(n,{code:l.join(", "),message:i.join("<br> ")})),t.show().addClass("animated fadeIn"))})},processInstallSteps:function(e){var t=!0,n=[],r=[],a=null,s=Installer.$pageContent.find(".install-progress .message");$.each(e,function(e,l){var i=Installer.Steps.install.steps[e];$.each(l,function(l,o){n.push(function(){var n,l=$.Deferred(),c=Mustache.render(i.msg,o);return n={process:o.process,disableLog:!0,item:o},s.text(c),Installer.sendRequest("onInstall",n,c).done(function(n){setTimeout(function(){if(n.result)"install"===e&&(a=n.result),l.resolve();else{t=!1;var c=Mustache.render(i.error,o);s.text(c),r.push(c),l.resolve()}l.resolve()},500)}).fail(function(){setTimeout(function(){t=!1,l.resolve()},500)}),l})})}),$.waterfall.apply(this,n).always(function(){}).done(function(){t?(Installer.$page.find(".card-header").addClass("fadeIn").removeClass("animated fadeOut d-none"),Installer.renderView("proceed",{proceedUrl:a,frontUrl:"/"}),Installer.updateWizard("proceed")):(Installer.$pageContent.html($('[data-partial="_alert__alert_install_failed"]').html()),$(".install_failed .message").text(r.join("<br />")))})},renderView:function(e,t){var n=Installer.Steps[e],r=n.view;if(n||(n={}),n.title&&Installer.$page.find('[data-html="title"]').html(n.title),n.subTitle&&Installer.$page.find('[data-html="subTitle"]').html(n.subTitle),e){var a=Mustache.render($(r).html(),$.extend(n,t,{}));Installer.$pageContent.html(a)}Installer.$pageModal.modal("hide")},flashMessage:function(e,t){if(t){var n=$(Installer.options.flashMessageSelector),r=$("<div />",{class:"animated bounceIn shadow alert alert-"+e});n.empty(),n.addClass("show"),r.append('<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'),r.append(t),n.append(r),"danger"!==e&&r.delay(5e3).fadeOut(400,function(){$(this).remove()})}},processResponse:function(e){var t=e.flash,n=e.modal,r=e.step;if(t&&Installer.flashMessage(t.type,t.message),n){var a=$('[data-partial="'+n+'"]').clone().html();Installer.$pageModal.html(Mustache.render(a)),Installer.$pageModal.modal()}switch(r){case"database":case"settings":case"install":Installer.renderView(r),Installer.updateWizard(r)}},fetchThemes:function(){var e=Installer.$pageContent.find(".install-progress");Installer.$pageContent.find('[data-html="install-type"]').fadeOut(),e.fadeIn(),Installer.sendRequest("onFetchItems",{}).done(function(t){e.fadeOut(),Installer.buildThemesList(t.data)}).always(function(){e.fadeOut()})},buildThemesList:function(e){var t=Installer.$pageContent.find('[data-html="themes"]'),n=$('[data-partial="theme"]'),r=[];for(var a in e){var s,l=e[a];s=Mustache.render(n.clone().html(),l),t.append(s),r[l.code]=l}Installer.Steps.install.dataCache=r},processInstall:function(e){var t,n=e.data("themeCode"),r=Installer.Steps.install.dataCache[n];t=$.extend(r,{process:"apply",disableLog:!0}),e.attr("disabled",!0),Installer.$page.find(".card-header").addClass("animated fadeOut d-none"),Installer.$pageContent.html($('[data-partial="_alert_install_progress"]').html()),Installer.sendRequest("onInstall",t).done(function(e){Installer.processInstallSteps(e.result),Installer.updateWizard("install")}).fail(function(){Installer.$pageContent.html($('[data-partial="install"]').html())}).always(function(){e.attr("disabled",!1)})}};